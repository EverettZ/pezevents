# This file was auto-generated by the Firebase CLI
# https://github.com/firebase/firebase-tools

name: Deploy to Dev
'on': 
  push:
    branches:
      - develop

jobs:

  # Print github context
  print_github_context:
    runs-on: ubuntu-latest
    steps:
      - name: Dump GitHub context
        env:
          GITHUB_CONTEXT: ${{ toJSON(github) }}
        run: echo "$GITHUB_CONTEXT"

  # Deploy app to development
  # dev.sezzion.com
  dev_deploy:
    runs-on: ubuntu-latest
    if: github.ref == 'develop'

    steps:
    - uses: actions/checkout@master
    - uses: actions/setup-node@master
      with:
        node-version: '13.x'
    - run: npm ci
    - run: npm run build
    - uses: w9jds/firebase-action@master
      with:
        args: deploy -P dev-pezevents --only hosting:dev-pezevents 
      env:
        FIREBASE_TOKEN: ${{ secrets.FIREBASE_CI_TOKEN }}

  # Deploy app to staging
  # stage.sezzion.com
  staging_deploy:
    runs-on: ubuntu-latest
    if: github.ref == 'staging'

    steps:
    - uses: actions/checkout@master
    - uses: actions/setup-node@master
      with:
        node-version: '13.x'
    - run: npm ci
    - run: npm run build
    - uses: w9jds/firebase-action@master
      with:
        args: deploy -P stage-pezevents --only hosting:stage-pezevents 
      env:
        FIREBASE_TOKEN: ${{ secrets.FIREBASE_CI_TOKEN }}

  # Deploy app to production. 
  # sezzion.com
  prod_deploy:
    runs-on: ubuntu-latest
    if: github.ref == 'main'

    steps:
      - uses: actions/checkout@v2
      - run: npm ci && npm run build --prod
      - uses: FirebaseExtended/action-hosting-deploy@v0
        with:
          repoToken: '${{ secrets.GITHUB_TOKEN }}'
          firebaseServiceAccount: '${{ secrets.FIREBASE_SERVICE_ACCOUNT_PEZEVENTS }}'
          channelId: live
          projectId: pezevents
          target: pezevents
        env:
          FIREBASE_CLI_PREVIEWS: hostingchannels
